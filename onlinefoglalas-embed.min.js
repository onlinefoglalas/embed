"use strict";"undefined"!=typeof window&&void 0===window.OnlinefoglalasEmbed&&(window.__OnlinefoglalasEmbedQueue=[],window.OnlinefoglalasEmbed=function(e){window.__OnlinefoglalasEmbedQueue.push(e)}),function(){class e{constructor(e){this.config={container:e.container||"onlinefoglalas-embed",domain:e.domain||"",locale:e.locale||"hu",height:e.height||"auto",width:e.width||"100%",baseUrl:e.baseUrl||"https://onlinefoglalas.hu",credentials:void 0===e.credentials||e.credentials,useShadowDOM:void 0!==e.useShadowDOM&&e.useShadowDOM,cssIsolation:void 0!==e.cssIsolation&&e.cssIsolation,onLoad:e.onLoad||null,onError:e.onError||null},this.container=null,this.shadowRoot=null,this.initialized=!1,this.init()}init(){if(!this.initialized)if("string"==typeof this.config.container?this.container=document.getElementById(this.config.container):this.config.container instanceof HTMLElement&&(this.container=this.config.container),this.container){if(!this.config.domain)return console.error("OnlinefoglalasEmbed: Domain is required"),void(this.config.onError&&this.config.onError("Domain is required"));this.config.cssIsolation&&this.setupCSSIsolation(),this.showLoading(),this.loadContent(),this.initialized=!0}else this.config.onError&&this.config.onError("Container not found")}setupCSSIsolation(){const e=document.createElement("div");e.className="onlinefoglalas-embed-isolation-wrapper",e.style.cssText="all: initial; display: block; width: 100%; max-width: 1001px; margin: 0 auto;",this.container.appendChild(e),this.container=e}showLoading(){if(this.container.innerHTML='<div class="onlinefoglalas-embed-loading" style="all: initial; display: block; text-align: center; padding: 40px; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;"><div class="onlinefoglalas-spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #37D0C2; border-radius: 50%; width: 40px; height: 40px; animation: onlinefoglalas-spin 1s linear infinite; margin: 0 auto;"></div><p style="margin-top: 15px; color: #666; font-size: 14px;">Betöltés...</p></div>',!document.getElementById("onlinefoglalas-embed-styles")){const e=document.createElement("style");e.id="onlinefoglalas-embed-styles",e.textContent="\n                    /* Scoped animations with prefix */\n                    @keyframes onlinefoglalas-spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                    \n                    /* Isolation wrapper - reset everything */\n                    .onlinefoglalas-embed-isolation-wrapper {\n                        all: initial;\n                        display: block !important;\n                        width: 100% !important;\n                        max-width: 1001px !important;\n                        margin: 0 auto !important;\n                        box-sizing: border-box !important;\n                    }\n                    \n                    /* Wrapper with scoped styles */\n                    .onlinefoglalas-embed-wrapper {\n                        all: initial;\n                        display: block !important;\n                        width: 100% !important;\n                        max-width: 1001px !important;\n                        margin: 0 auto !important;\n                        box-sizing: border-box !important;\n                    }\n                    \n                    /* Error messages with scoped styles */\n                    .onlinefoglalas-embed-error {\n                        all: initial;\n                        display: block !important;\n                        background-color: #ffebee !important;\n                        color: #c62828 !important;\n                        padding: 20px !important;\n                        border-radius: 4px !important;\n                        border-left: 4px solid #c62828 !important;\n                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n                        font-size: 14px !important;\n                        line-height: 1.5 !important;\n                        box-sizing: border-box !important;\n                    }\n                    \n                    /* Protect embedded content from external CSS */\n                    .onlinefoglalas-embed-wrapper * {\n                        box-sizing: border-box !important;\n                    }\n                ",document.head.appendChild(e)}}showError(e){this.container.innerHTML=`\n                <div class="onlinefoglalas-embed-error">\n                    <strong>Hiba:</strong> ${e}\n                </div>\n            `,this.config.onError&&this.config.onError(e)}buildUrl(){let e=this.config.baseUrl;return this.config.locale&&"hu"!==this.config.locale&&(e+="/"+this.config.locale),e+="/"+this.config.domain,e+="?embed=1",e}async loadContent(){try{const e=this.buildUrl(),t={method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},cache:"no-store"};this.config.credentials&&(t.credentials="include");performance.now();const n=await fetch(e,t);performance.now();if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.text(),o=document.createElement("div");o.className="onlinefoglalas-embed-wrapper","auto"!==this.config.height&&(o.style.height=this.config.height+"px",o.style.overflowY="auto"),o.innerHTML=i,this.container.innerHTML="",this.container.appendChild(o),this.injectStyles(o),await this.executeScripts(o),await this.waitForStepScripts(o),await this.ensureBookingPanelInitialized(o),this.setupCommunication(),"auto"===this.config.height&&this.setupAutoResize(o),this.config.onLoad&&this.config.onLoad()}catch(e){console.error("OnlinefoglalasEmbed: Error loading content",e),console.error("OnlinefoglalasEmbed: Error stack:",e.stack),this.showError("Nem sikerült betölteni a tartalmat. Kérjük, próbálja újra később.")}}async executeScripts(e){const t=Array.from(e.querySelectorAll("script")),n=[],i=[],o=[],a=[];t.forEach(((e,t)=>{if(e.src)return void n.push({script:e,idx:t});const r=e.textContent||"",s=/bookneticInitBookingPage|initBookingPanel/i.test(r),l=/(BookneticData|BookneticConversionTrackingData|servicesWithCustomDuration|current_locale|window\.bookneticHooks)/i.test(r);s?o.push({script:e,idx:t}):l?i.push({script:e,idx:t}):a.push({script:e,idx:t})}));for(const e of i)await this.loadScript(e.script,e.idx);for(const e of n)await this.loadScript(e.script,e.idx);for(const e of a)await this.loadScript(e.script,e.idx);for(const e of o)await this.loadScript(e.script,e.idx)}loadScript(e,t){return new Promise(((n,i)=>{const o=document.createElement("script"),a=(e.type||"").trim();if(!(""===a||"text/javascript"===a||"application/javascript"===a||"module"===a))return n();if(Array.from(e.attributes).forEach((e=>{o.setAttribute(e.name,e.value)})),e.src)o.onload=()=>{n()},o.onerror=()=>{console.warn(`OnlinefoglalasEmbed: Failed to load script #${t}:`,e.src),n()},e.parentNode.replaceChild(o,e),o.src=e.src;else{e.textContent.substring(0,100).replace(/\n/g," ");o.textContent=e.textContent,e.parentNode.replaceChild(o,e),setTimeout(n,0)}}))}async waitForStepScripts(e){const t=Date.now();return new Promise((e=>{const n=()=>{const i=Date.now()-t;if(void 0===window.bookneticHooks)return void(i<3e3?setTimeout(n,50):(console.warn("OnlinefoglalasEmbed: Timeout waiting for bookneticHooks"),e()));const o=(window.bookneticHooks.hooks||{}).before_step_loading||{};Object.keys(o).length>0||i>=500?e():i<3e3?setTimeout(n,50):(console.warn("OnlinefoglalasEmbed: Timeout waiting for step scripts, proceeding anyway..."),e())};setTimeout(n,100)}))}async ensureBookingPanelInitialized(e){const t=Date.now();return new Promise((n=>{const i=()=>{const o=Date.now()-t;if(void 0===window.bookneticInitBookingPage)return void(o<2e3?setTimeout(i,50):(console.warn("OnlinefoglalasEmbed: Timeout waiting for bookneticInitBookingPage"),n()));if("undefined"==typeof jQuery)return void(o<2e3?setTimeout(i,50):(console.warn("OnlinefoglalasEmbed: Timeout waiting for jQuery"),n()));const a=e.querySelectorAll(".booknetic_appointment");if(0===a.length)return void n();let r=!0;a.forEach((e=>{if(!(!0===jQuery(e).data("booknetic_has_been_initiated"))){r=!1;try{window.bookneticInitBookingPage(e)}catch(e){console.error("OnlinefoglalasEmbed: Error initializing booking panel:",e)}}})),n()};setTimeout(i,100)}))}injectStyles(e){e.querySelectorAll('link[rel="stylesheet"], style').forEach((e=>{if(!document.head.contains(e)){const t=e.cloneNode(!0);document.head.appendChild(t)}}))}setupCommunication(){window.addEventListener("message",(e=>{e.data&&"onlinefoglalas-embed"===e.data.type&&this.handleMessage(e.data)}))}handleMessage(e){switch(e.action){case"resize":e.height&&(this.container.style.height=e.height+"px");break;case"navigate":e.url&&(window.location.href=e.url)}}setupAutoResize(e){if("undefined"!=typeof ResizeObserver){new ResizeObserver((e=>{for(let t of e){const e=t.contentRect.height;this.container.style.height=e+"px"}})).observe(e)}else setInterval((()=>{const t=e.scrollHeight;t>0&&(this.container.style.height=t+"px")}),500)}destroy(){this.container&&(this.container.innerHTML=""),this.initialized=!1}reload(){this.destroy(),this.init()}}window.OnlinefoglalasEmbed=e,Array.isArray(window.__OnlinefoglalasEmbedQueue)&&window.__OnlinefoglalasEmbedQueue.length>0&&(window.__OnlinefoglalasEmbedQueue.forEach((t=>{try{new e(t)}catch(e){console.error("OnlinefoglalasEmbed: Error processing queued init",e)}})),window.__OnlinefoglalasEmbedQueue=[]);const t=function(t){document.querySelectorAll("[data-onlinefoglalas-embed]").forEach(((t,n)=>{if("true"===t.dataset.onlinefoglalasEmbedInitialized)return;const i="false"!==t.getAttribute("data-credentials"),o={container:t,domain:t.getAttribute("data-domain"),locale:t.getAttribute("data-locale")||"hu",height:t.getAttribute("data-height")||"auto",width:t.getAttribute("data-width")||"100%",baseUrl:t.getAttribute("data-base-url")||window.location.origin,credentials:i};new e(o),t.dataset.onlinefoglalasEmbedInitialized="true"}))};let n=!1;try{if("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>t())):t(),"undefined"!=typeof MutationObserver){new MutationObserver((e=>{let i=!1;for(const t of e){for(const e of t.addedNodes)if(1===e.nodeType){if(e.hasAttribute&&e.hasAttribute("data-onlinefoglalas-embed")){i=!0;break}if(e.querySelector&&e.querySelector("[data-onlinefoglalas-embed]")){i=!0;break}}if(i)break}i&&(n||(n=!0,setTimeout((()=>{n=!1,t()}),50)))})).observe(document.documentElement||document.body,{childList:!0,subtree:!0})}}catch(e){console.error("OnlinefoglalasEmbed: Auto-init error",e)}}();
