!function(){"use strict";class t{constructor(t){this.config={container:t.container||"onlinefoglalas-embed",domain:t.domain||"",locale:t.locale||"hu",height:t.height||"auto",width:t.width||"100%",baseUrl:t.baseUrl||"https://onlinefoglalas.hu",credentials:void 0===t.credentials||t.credentials,useShadowDOM:void 0===t.useShadowDOM||t.useShadowDOM,cssIsolation:void 0===t.cssIsolation||t.cssIsolation,onLoad:t.onLoad||null,onError:t.onError||null},this.container=null,this.shadowRoot=null,this.initialized=!1,this.init()}init(){if(!this.initialized){if("string"==typeof this.config.container?this.container=document.getElementById(this.config.container):this.config.container instanceof HTMLElement&&(this.container=this.config.container),!this.container)return console.error("OnlinefoglalasEmbed: Container not found"),void(this.config.onError&&this.config.onError("Container not found"));if(!this.config.domain)return console.error("OnlinefoglalasEmbed: Domain is required"),void(this.config.onError&&this.config.onError("Domain is required"));if(this.config.useShadowDOM&&this.container.attachShadow)try{this.shadowRoot=this.container.attachShadow({mode:"open"}),console.info("OnlinefoglalasEmbed: Using Shadow DOM for CSS isolation")}catch(t){console.warn("OnlinefoglalasEmbed: Shadow DOM failed, falling back to CSS isolation",t),this.shadowRoot=null}!this.shadowRoot&&this.config.cssIsolation&&this.setupCSSIsolation(),this.showLoading(),this.loadContent(),this.initialized=!0}}setupCSSIsolation(){const t=document.createElement("div");t.className="onlinefoglalas-embed-isolation-wrapper",t.style.cssText="all: initial; display: block; width: 100%; max-width: 1001px; margin: 0 auto;",this.container.appendChild(t),this.container=t}showLoading(){const t='<div class="onlinefoglalas-embed-loading" style="all: initial; display: block; text-align: center; padding: 40px; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;"><div class="onlinefoglalas-spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #37D0C2; border-radius: 50%; width: 40px; height: 40px; animation: onlinefoglalas-spin 1s linear infinite; margin: 0 auto;"></div><p style="margin-top: 15px; color: #666; font-size: 14px;">Betöltés...</p></div>';if(this.shadowRoot)this.shadowRoot.innerHTML=t,this.injectBaseStyles();else if(this.container.innerHTML=t,!document.getElementById("onlinefoglalas-embed-styles")){const t=document.createElement("style");t.id="onlinefoglalas-embed-styles",t.textContent=this.getBaseStyles(),document.head.appendChild(t)}}getBaseStyles(){return"\n                /* Scoped animations with prefix */\n                @keyframes onlinefoglalas-spin {\n                    0% { transform: rotate(0deg); }\n                    100% { transform: rotate(360deg); }\n                }\n                \n                /* Isolation wrapper - reset everything */\n                .onlinefoglalas-embed-isolation-wrapper {\n                    all: initial;\n                    display: block !important;\n                    width: 100% !important;\n                    max-width: 1001px !important;\n                    margin: 0 auto !important;\n                    box-sizing: border-box !important;\n                }\n                \n                /* Wrapper with scoped styles */\n                .onlinefoglalas-embed-wrapper {\n                    all: initial;\n                    display: block !important;\n                    width: 100% !important;\n                    max-width: 1001px !important;\n                    margin: 0 auto !important;\n                    box-sizing: border-box !important;\n                }\n                \n                /* Error messages with scoped styles */\n                .onlinefoglalas-embed-error {\n                    all: initial;\n                    display: block !important;\n                    background-color: #ffebee !important;\n                    color: #c62828 !important;\n                    padding: 20px !important;\n                    border-radius: 4px !important;\n                    border-left: 4px solid #c62828 !important;\n                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n                    font-size: 14px !important;\n                    line-height: 1.5 !important;\n                    box-sizing: border-box !important;\n                }\n                \n                /* Protect embedded content from external CSS */\n                .onlinefoglalas-embed-wrapper * {\n                    box-sizing: border-box !important;\n                }\n            "}injectBaseStyles(){if(this.shadowRoot){const t=document.createElement("style");t.textContent=this.getBaseStyles(),this.shadowRoot.appendChild(t)}}showError(t){const e=`\n                <div class="onlinefoglalas-embed-error">\n                    <strong>Hiba:</strong> ${t}\n                </div>\n            `;this.shadowRoot?(this.shadowRoot.innerHTML=e,this.injectBaseStyles()):this.container.innerHTML=e,this.config.onError&&this.config.onError(t)}buildUrl(){let t=this.config.baseUrl;return this.config.locale&&"hu"!==this.config.locale&&(t+="/"+this.config.locale),t+="/"+this.config.domain,t+="?embed=1",t}async loadContent(){try{const t=this.buildUrl(),e={method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}};this.config.credentials&&(e.credentials="include");const n=await fetch(t,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.text(),i=document.createElement("div");i.className="onlinefoglalas-embed-wrapper","auto"!==this.config.height&&(i.style.height=this.config.height+"px",i.style.overflowY="auto"),i.innerHTML=o,this.shadowRoot?(this.shadowRoot.innerHTML="",this.shadowRoot.appendChild(i)):(this.container.innerHTML="",this.container.appendChild(i)),this.injectStyles(i),await this.executeScripts(i),this.setupCommunication(),"auto"===this.config.height&&this.setupAutoResize(i),this.config.onLoad&&this.config.onLoad()}catch(t){console.error("OnlinefoglalasEmbed: Error loading content",t),this.showError("Nem sikerült betölteni a tartalmat. Kérjük, próbálja újra később.")}}async executeScripts(t){const e=t.querySelectorAll("script");for(let t=0;t<e.length;t++){const n=e[t];await this.loadScript(n)}}loadScript(t){return new Promise(((e,n)=>{const o=document.createElement("script");Array.from(t.attributes).forEach((t=>{o.setAttribute(t.name,t.value)})),t.src?(o.onload=()=>{e()},o.onerror=()=>{console.warn("Failed to load script:",t.src),e()},t.parentNode.replaceChild(o,t),o.src=t.src):(o.textContent=t.textContent,t.parentNode.replaceChild(o,t),setTimeout(e,0))}))}injectStyles(t){const e=t.querySelectorAll('link[rel="stylesheet"], style');this.shadowRoot?e.forEach((t=>{const e=t.cloneNode(!0);this.shadowRoot.appendChild(e)})):e.forEach((t=>{if(!document.head.contains(t)){const e=t.cloneNode(!0);document.head.appendChild(e)}}))}setupCommunication(){window.addEventListener("message",(t=>{t.data&&"onlinefoglalas-embed"===t.data.type&&this.handleMessage(t.data)}))}handleMessage(t){switch(t.action){case"resize":t.height&&(this.container.style.height=t.height+"px");break;case"navigate":t.url&&(window.location.href=t.url)}}setupAutoResize(t){if("undefined"!=typeof ResizeObserver){new ResizeObserver((t=>{for(let e of t){const t=e.contentRect.height;this.container.style.height=t+"px"}})).observe(t)}else setInterval((()=>{const e=t.scrollHeight;e>0&&(this.container.style.height=e+"px")}),500)}destroy(){this.shadowRoot?this.shadowRoot.innerHTML="":this.container&&(this.container.innerHTML=""),this.initialized=!1}reload(){this.destroy(),this.init()}}window.OnlinefoglalasEmbed=t,document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("[data-onlinefoglalas-embed]").forEach((e=>{const n="false"!==e.getAttribute("data-credentials"),o={container:e,domain:e.getAttribute("data-domain"),locale:e.getAttribute("data-locale")||"hu",height:e.getAttribute("data-height")||"auto",width:e.getAttribute("data-width")||"100%",baseUrl:e.getAttribute("data-base-url")||window.location.origin,credentials:n};new t(o)}))}))}();
