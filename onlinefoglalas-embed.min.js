!function(){"use strict";class e{constructor(e){this.config={container:e.container||"onlinefoglalas-embed",domain:e.domain||"",locale:e.locale||"hu",height:e.height||"auto",width:e.width||"100%",baseUrl:e.baseUrl||"https://onlinefoglalas.hu",credentials:void 0===e.credentials||e.credentials,useShadowDOM:void 0!==e.useShadowDOM&&e.useShadowDOM,cssIsolation:void 0===e.cssIsolation||e.cssIsolation,onLoad:e.onLoad||null,onError:e.onError||null},this.container=null,this.shadowRoot=null,this.initialized=!1,this.init()}init(){if(!this.initialized){if("string"==typeof this.config.container?this.container=document.getElementById(this.config.container):this.config.container instanceof HTMLElement&&(this.container=this.config.container),!this.container)return console.error("OnlinefoglalasEmbed: Container not found"),void(this.config.onError&&this.config.onError("Container not found"));if(!this.config.domain)return console.error("OnlinefoglalasEmbed: Domain is required"),void(this.config.onError&&this.config.onError("Domain is required"));this.config.cssIsolation&&this.setupCSSIsolation(),this.showLoading(),this.loadContent(),this.initialized=!0}}setupCSSIsolation(){const e=document.createElement("div");e.className="onlinefoglalas-embed-isolation-wrapper",e.style.cssText="all: initial; display: block; width: 100%; max-width: 1001px; margin: 0 auto;",this.container.appendChild(e),this.container=e}showLoading(){if(this.container.innerHTML='<div class="onlinefoglalas-embed-loading" style="all: initial; display: block; text-align: center; padding: 40px; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;"><div class="onlinefoglalas-spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #37D0C2; border-radius: 50%; width: 40px; height: 40px; animation: onlinefoglalas-spin 1s linear infinite; margin: 0 auto;"></div><p style="margin-top: 15px; color: #666; font-size: 14px;">Betöltés...</p></div>',!document.getElementById("onlinefoglalas-embed-styles")){const e=document.createElement("style");e.id="onlinefoglalas-embed-styles",e.textContent="\n                    /* Scoped animations with prefix */\n                    @keyframes onlinefoglalas-spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                    \n                    /* Isolation wrapper - reset everything */\n                    .onlinefoglalas-embed-isolation-wrapper {\n                        all: initial;\n                        display: block !important;\n                        width: 100% !important;\n                        max-width: 1001px !important;\n                        margin: 0 auto !important;\n                        box-sizing: border-box !important;\n                    }\n                    \n                    /* Wrapper with scoped styles */\n                    .onlinefoglalas-embed-wrapper {\n                        all: initial;\n                        display: block !important;\n                        width: 100% !important;\n                        max-width: 1001px !important;\n                        margin: 0 auto !important;\n                        box-sizing: border-box !important;\n                    }\n                    \n                    /* Error messages with scoped styles */\n                    .onlinefoglalas-embed-error {\n                        all: initial;\n                        display: block !important;\n                        background-color: #ffebee !important;\n                        color: #c62828 !important;\n                        padding: 20px !important;\n                        border-radius: 4px !important;\n                        border-left: 4px solid #c62828 !important;\n                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n                        font-size: 14px !important;\n                        line-height: 1.5 !important;\n                        box-sizing: border-box !important;\n                    }\n                    \n                    /* Protect embedded content from external CSS */\n                    .onlinefoglalas-embed-wrapper * {\n                        box-sizing: border-box !important;\n                    }\n                ",document.head.appendChild(e)}}showError(e){this.container.innerHTML=`\n                <div class="onlinefoglalas-embed-error">\n                    <strong>Hiba:</strong> ${e}\n                </div>\n            `,this.config.onError&&this.config.onError(e)}buildUrl(){let e=this.config.baseUrl;return this.config.locale&&"hu"!==this.config.locale&&(e+="/"+this.config.locale),e+="/"+this.config.domain,e+="?embed=1",e}async loadContent(){try{const e=this.buildUrl(),t={method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},cache:"no-store"};this.config.credentials&&(t.credentials="include");const n=await fetch(e,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const i=await n.text(),o=document.createElement("div");o.className="onlinefoglalas-embed-wrapper","auto"!==this.config.height&&(o.style.height=this.config.height+"px",o.style.overflowY="auto"),o.innerHTML=i,this.container.innerHTML="",this.container.appendChild(o),this.injectStyles(o),await this.executeScripts(o),this.setupCommunication(),"auto"===this.config.height&&this.setupAutoResize(o),this.config.onLoad&&this.config.onLoad()}catch(e){console.error("OnlinefoglalasEmbed: Error loading content",e),this.showError("Nem sikerült betölteni a tartalmat. Kérjük, próbálja újra később.")}}async executeScripts(e){const t=e.querySelectorAll("script");console.log(`OnlinefoglalasEmbed: Found ${t.length} scripts to execute`);for(let e=0;e<t.length;e++){const n=t[e];await this.loadScript(n,e)}console.log("OnlinefoglalasEmbed: All scripts executed")}loadScript(e,t){return new Promise(((n,i)=>{const o=document.createElement("script");if(Array.from(e.attributes).forEach((e=>{o.setAttribute(e.name,e.value)})),e.src)console.log(`OnlinefoglalasEmbed: Loading external script #${t}:`,e.src),o.onload=()=>{console.log(`OnlinefoglalasEmbed: External script #${t} loaded`),n()},o.onerror=()=>{console.warn(`OnlinefoglalasEmbed: Failed to load script #${t}:`,e.src),n()},e.parentNode.replaceChild(o,e),o.src=e.src;else{const i=e.textContent.substring(0,100).replace(/\n/g," ");console.log(`OnlinefoglalasEmbed: Executing inline script #${t}:`,i+"..."),o.textContent=e.textContent,e.parentNode.replaceChild(o,e),console.log(`OnlinefoglalasEmbed: Inline script #${t} executed`),setTimeout(n,0)}}))}injectStyles(e){e.querySelectorAll('link[rel="stylesheet"], style').forEach((e=>{if(!document.head.contains(e)){const t=e.cloneNode(!0);document.head.appendChild(t)}}))}setupCommunication(){window.addEventListener("message",(e=>{e.data&&"onlinefoglalas-embed"===e.data.type&&this.handleMessage(e.data)}))}handleMessage(e){switch(e.action){case"resize":e.height&&(this.container.style.height=e.height+"px");break;case"navigate":e.url&&(window.location.href=e.url)}}setupAutoResize(e){if("undefined"!=typeof ResizeObserver){new ResizeObserver((e=>{for(let t of e){const e=t.contentRect.height;this.container.style.height=e+"px"}})).observe(e)}else setInterval((()=>{const t=e.scrollHeight;t>0&&(this.container.style.height=t+"px")}),500)}destroy(){this.container&&(this.container.innerHTML=""),this.initialized=!1}reload(){this.destroy(),this.init()}}window.OnlinefoglalasEmbed=e,document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("[data-onlinefoglalas-embed]").forEach((t=>{const n="false"!==t.getAttribute("data-credentials"),i={container:t,domain:t.getAttribute("data-domain"),locale:t.getAttribute("data-locale")||"hu",height:t.getAttribute("data-height")||"auto",width:t.getAttribute("data-width")||"100%",baseUrl:t.getAttribute("data-base-url")||window.location.origin,credentials:n};new e(i)}))}))}();
