"use strict";"undefined"!=typeof window&&void 0===window.OnlinefoglalasEmbed&&(window.__OnlinefoglalasEmbedQueue=[],window.OnlinefoglalasEmbed=function(e){window.__OnlinefoglalasEmbedQueue.push(e)}),function(){class e{constructor(e){console.log("OnlinefoglalasEmbed: Constructor called with config:",e),this.config={container:e.container||"onlinefoglalas-embed",domain:e.domain||"",locale:e.locale||"hu",height:e.height||"auto",width:e.width||"100%",baseUrl:e.baseUrl||"https://onlinefoglalas.hu",credentials:void 0===e.credentials||e.credentials,useShadowDOM:void 0!==e.useShadowDOM&&e.useShadowDOM,cssIsolation:void 0!==e.cssIsolation&&e.cssIsolation,onLoad:e.onLoad||null,onError:e.onError||null},console.log("OnlinefoglalasEmbed: Processed config:",this.config),this.container=null,this.shadowRoot=null,this.initialized=!1,console.log("OnlinefoglalasEmbed: Calling init()"),this.init()}init(){if(console.log("OnlinefoglalasEmbed: init() called",{initialized:this.initialized,config:this.config,timestamp:(new Date).toISOString()}),this.initialized)console.log("OnlinefoglalasEmbed: Already initialized, skipping");else{if("string"==typeof this.config.container?(console.log("OnlinefoglalasEmbed: Looking for container by ID:",this.config.container),this.container=document.getElementById(this.config.container)):this.config.container instanceof HTMLElement&&(console.log("OnlinefoglalasEmbed: Container provided as HTMLElement"),this.container=this.config.container),!this.container)return console.error("OnlinefoglalasEmbed: Container not found"),void(this.config.onError&&this.config.onError("Container not found"));if(console.log("OnlinefoglalasEmbed: Container found:",this.container),!this.config.domain)return console.error("OnlinefoglalasEmbed: Domain is required"),void(this.config.onError&&this.config.onError("Domain is required"));console.log("OnlinefoglalasEmbed: Domain configured:",this.config.domain),this.config.cssIsolation&&(console.log("OnlinefoglalasEmbed: Setting up CSS isolation"),this.setupCSSIsolation()),console.log("OnlinefoglalasEmbed: Showing loading indicator"),this.showLoading(),console.log("OnlinefoglalasEmbed: Starting content load"),this.loadContent(),this.initialized=!0,console.log("OnlinefoglalasEmbed: Initialization complete")}}setupCSSIsolation(){const e=document.createElement("div");e.className="onlinefoglalas-embed-isolation-wrapper",e.style.cssText="all: initial; display: block; width: 100%; max-width: 1001px; margin: 0 auto;",this.container.appendChild(e),this.container=e}showLoading(){if(this.container.innerHTML='<div class="onlinefoglalas-embed-loading" style="all: initial; display: block; text-align: center; padding: 40px; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;"><div class="onlinefoglalas-spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #37D0C2; border-radius: 50%; width: 40px; height: 40px; animation: onlinefoglalas-spin 1s linear infinite; margin: 0 auto;"></div><p style="margin-top: 15px; color: #666; font-size: 14px;">Betöltés...</p></div>',!document.getElementById("onlinefoglalas-embed-styles")){const e=document.createElement("style");e.id="onlinefoglalas-embed-styles",e.textContent="\n                    /* Scoped animations with prefix */\n                    @keyframes onlinefoglalas-spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                    \n                    /* Isolation wrapper - reset everything */\n                    .onlinefoglalas-embed-isolation-wrapper {\n                        all: initial;\n                        display: block !important;\n                        width: 100% !important;\n                        max-width: 1001px !important;\n                        margin: 0 auto !important;\n                        box-sizing: border-box !important;\n                    }\n                    \n                    /* Wrapper with scoped styles */\n                    .onlinefoglalas-embed-wrapper {\n                        all: initial;\n                        display: block !important;\n                        width: 100% !important;\n                        max-width: 1001px !important;\n                        margin: 0 auto !important;\n                        box-sizing: border-box !important;\n                    }\n                    \n                    /* Error messages with scoped styles */\n                    .onlinefoglalas-embed-error {\n                        all: initial;\n                        display: block !important;\n                        background-color: #ffebee !important;\n                        color: #c62828 !important;\n                        padding: 20px !important;\n                        border-radius: 4px !important;\n                        border-left: 4px solid #c62828 !important;\n                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n                        font-size: 14px !important;\n                        line-height: 1.5 !important;\n                        box-sizing: border-box !important;\n                    }\n                    \n                    /* Protect embedded content from external CSS */\n                    .onlinefoglalas-embed-wrapper * {\n                        box-sizing: border-box !important;\n                    }\n                ",document.head.appendChild(e)}}showError(e){this.container.innerHTML=`\n                <div class="onlinefoglalas-embed-error">\n                    <strong>Hiba:</strong> ${e}\n                </div>\n            `,this.config.onError&&this.config.onError(e)}buildUrl(){let e=this.config.baseUrl;return console.log("OnlinefoglalasEmbed: Building URL - baseUrl:",e),this.config.locale&&"hu"!==this.config.locale&&(e+="/"+this.config.locale,console.log("OnlinefoglalasEmbed: Added locale:",this.config.locale)),e+="/"+this.config.domain,console.log("OnlinefoglalasEmbed: Added domain:",this.config.domain),e+="?embed=1",console.log("OnlinefoglalasEmbed: Final URL:",e),e}async loadContent(){console.log("OnlinefoglalasEmbed: loadContent() started");try{const e=this.buildUrl(),o={method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"},cache:"no-store"};this.config.credentials?(o.credentials="include",console.log("OnlinefoglalasEmbed: Credentials enabled (include cookies)")):console.log("OnlinefoglalasEmbed: Credentials disabled"),console.log("OnlinefoglalasEmbed: Fetch options:",o),console.log("OnlinefoglalasEmbed: Starting fetch request to:",e),console.log("OnlinefoglalasEmbed: Current cookies:",document.cookie);const n=performance.now(),i=await fetch(e,o),t=performance.now();if(console.log("OnlinefoglalasEmbed: Fetch completed in",(t-n).toFixed(2),"ms"),console.log("OnlinefoglalasEmbed: Response status:",i.status),console.log("OnlinefoglalasEmbed: Response headers:",Array.from(i.headers.entries())),!i.ok)throw new Error(`HTTP error! status: ${i.status}`);console.log("OnlinefoglalasEmbed: Reading response text...");const l=await i.text();console.log("OnlinefoglalasEmbed: Response HTML length:",l.length,"bytes"),console.log("OnlinefoglalasEmbed: Response HTML preview:",l.substring(0,200)+"..."),console.log("OnlinefoglalasEmbed: Creating wrapper element");const a=document.createElement("div");a.className="onlinefoglalas-embed-wrapper","auto"!==this.config.height&&(a.style.height=this.config.height+"px",a.style.overflowY="auto",console.log("OnlinefoglalasEmbed: Set fixed height:",this.config.height+"px")),console.log("OnlinefoglalasEmbed: Setting wrapper innerHTML"),a.innerHTML=l,console.log("OnlinefoglalasEmbed: Inserting wrapper into container"),this.container.innerHTML="",this.container.appendChild(a),console.log("OnlinefoglalasEmbed: Injecting styles"),this.injectStyles(a),console.log("OnlinefoglalasEmbed: Executing scripts"),await this.executeScripts(a),console.log("OnlinefoglalasEmbed: Waiting for step scripts to register hooks..."),await this.waitForStepScripts(a),console.log("OnlinefoglalasEmbed: Ensuring booking panel initialization..."),await this.ensureBookingPanelInitialized(a),console.log("OnlinefoglalasEmbed: Setting up communication"),this.setupCommunication(),"auto"===this.config.height&&(console.log("OnlinefoglalasEmbed: Setting up auto-resize"),this.setupAutoResize(a)),this.config.onLoad&&(console.log("OnlinefoglalasEmbed: Calling onLoad callback"),this.config.onLoad()),console.log("OnlinefoglalasEmbed: loadContent() completed successfully")}catch(e){console.error("OnlinefoglalasEmbed: Error loading content",e),console.error("OnlinefoglalasEmbed: Error stack:",e.stack),this.showError("Nem sikerült betölteni a tartalmat. Kérjük, próbálja újra később.")}}async executeScripts(e){const o=Array.from(e.querySelectorAll("script")),n=[],i=[],t=[],l=[];console.log(`OnlinefoglalasEmbed: Found ${o.length} scripts to execute`),o.forEach(((e,o)=>{if(e.src)return void n.push({script:e,idx:o});const a=e.textContent||"",s=/bookneticInitBookingPage|initBookingPanel/i.test(a),r=/(BookneticData|BookneticConversionTrackingData|servicesWithCustomDuration|current_locale|window\.bookneticHooks)/i.test(a);s?t.push({script:e,idx:o}):r?i.push({script:e,idx:o}):l.push({script:e,idx:o})}));for(const e of i)await this.loadScript(e.script,e.idx);for(const e of n)await this.loadScript(e.script,e.idx);for(const e of l)await this.loadScript(e.script,e.idx);for(const e of t)await this.loadScript(e.script,e.idx);console.log("OnlinefoglalasEmbed: All scripts executed")}loadScript(e,o){return new Promise(((n,i)=>{const t=document.createElement("script"),l=(e.type||"").trim();if(!(""===l||"text/javascript"===l||"application/javascript"===l||"module"===l))return console.log(`OnlinefoglalasEmbed: Skipping non-executable script #${o} (type=${l||"default"})`),n();if(Array.from(e.attributes).forEach((e=>{t.setAttribute(e.name,e.value)})),e.src)console.log(`OnlinefoglalasEmbed: Loading external script #${o}:`,e.src),t.onload=()=>{console.log(`OnlinefoglalasEmbed: External script #${o} loaded`),n()},t.onerror=()=>{console.warn(`OnlinefoglalasEmbed: Failed to load script #${o}:`,e.src),n()},e.parentNode.replaceChild(t,e),t.src=e.src;else{const i=e.textContent.substring(0,100).replace(/\n/g," ");console.log(`OnlinefoglalasEmbed: Executing inline script #${o}:`,i+"..."),t.textContent=e.textContent,e.parentNode.replaceChild(t,e),console.log(`OnlinefoglalasEmbed: Inline script #${o} executed`),setTimeout(n,0)}}))}async waitForStepScripts(e){const o=Date.now();return new Promise((e=>{const n=()=>{const i=Date.now()-o;if(void 0===window.bookneticHooks)return void(i<3e3?setTimeout(n,50):(console.warn("OnlinefoglalasEmbed: Timeout waiting for bookneticHooks"),e()));const t=(window.bookneticHooks.hooks||{}).before_step_loading||{},l=Object.keys(t).length;console.log("OnlinefoglalasEmbed: Registered before_step_loading hooks:",l,"after",i,"ms"),l>0||i>=500?(console.log("OnlinefoglalasEmbed: Step scripts ready, proceeding..."),e()):i<3e3?setTimeout(n,50):(console.warn("OnlinefoglalasEmbed: Timeout waiting for step scripts, proceeding anyway..."),e())};setTimeout(n,100)}))}async ensureBookingPanelInitialized(e){const o=Date.now();return new Promise((n=>{const i=()=>{const t=Date.now()-o;if(void 0===window.bookneticInitBookingPage)return void(t<2e3?setTimeout(i,50):(console.warn("OnlinefoglalasEmbed: Timeout waiting for bookneticInitBookingPage"),n()));if("undefined"==typeof jQuery)return void(t<2e3?setTimeout(i,50):(console.warn("OnlinefoglalasEmbed: Timeout waiting for jQuery"),n()));const l=e.querySelectorAll(".booknetic_appointment");if(console.log("OnlinefoglalasEmbed: Found",l.length,"booking panels"),0===l.length)return console.log("OnlinefoglalasEmbed: No booking panels found, proceeding..."),void n();let a=!0;l.forEach((e=>{if(!(!0===jQuery(e).data("booknetic_has_been_initiated"))){a=!1,console.log("OnlinefoglalasEmbed: Booking panel not initialized, initializing now...",e);try{window.bookneticInitBookingPage(e)}catch(e){console.error("OnlinefoglalasEmbed: Error initializing booking panel:",e)}}})),a?console.log("OnlinefoglalasEmbed: All booking panels already initialized"):console.log("OnlinefoglalasEmbed: Booking panels initialized manually"),n()};setTimeout(i,100)}))}injectStyles(e){e.querySelectorAll('link[rel="stylesheet"], style').forEach((e=>{if(!document.head.contains(e)){const o=e.cloneNode(!0);document.head.appendChild(o)}}))}setupCommunication(){window.addEventListener("message",(e=>{e.data&&"onlinefoglalas-embed"===e.data.type&&this.handleMessage(e.data)}))}handleMessage(e){switch(e.action){case"resize":e.height&&(this.container.style.height=e.height+"px");break;case"navigate":e.url&&(window.location.href=e.url)}}setupAutoResize(e){if("undefined"!=typeof ResizeObserver){new ResizeObserver((e=>{for(let o of e){const e=o.contentRect.height;this.container.style.height=e+"px"}})).observe(e)}else setInterval((()=>{const o=e.scrollHeight;o>0&&(this.container.style.height=o+"px")}),500)}destroy(){this.container&&(this.container.innerHTML=""),this.initialized=!1}reload(){this.destroy(),this.init()}}window.OnlinefoglalasEmbed=e,Array.isArray(window.__OnlinefoglalasEmbedQueue)&&window.__OnlinefoglalasEmbedQueue.length>0&&(window.__OnlinefoglalasEmbedQueue.forEach((o=>{try{new e(o)}catch(e){console.error("OnlinefoglalasEmbed: Error processing queued init",e)}})),window.__OnlinefoglalasEmbedQueue=[]);const o=function(o){console.log("OnlinefoglalasEmbed: Auto-init triggered",{timestamp:(new Date).toISOString(),readyState:document.readyState,trigger:o});const n=document.querySelectorAll("[data-onlinefoglalas-embed]");console.log("OnlinefoglalasEmbed: Found",n.length,"embed elements"),n.forEach(((o,n)=>{if("true"===o.dataset.onlinefoglalasEmbedInitialized)return;console.log(`OnlinefoglalasEmbed: Initializing element #${n}`,o);const i="false"!==o.getAttribute("data-credentials"),t={container:o,domain:o.getAttribute("data-domain"),locale:o.getAttribute("data-locale")||"hu",height:o.getAttribute("data-height")||"auto",width:o.getAttribute("data-width")||"100%",baseUrl:o.getAttribute("data-base-url")||window.location.origin,credentials:i};console.log(`OnlinefoglalasEmbed: Config for element #${n}:`,t),new e(t),o.dataset.onlinefoglalasEmbedInitialized="true"})),console.log("OnlinefoglalasEmbed: Auto-initialization complete")};let n=!1;try{if("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>o("DOMContentLoaded"))):o("immediate"),"undefined"!=typeof MutationObserver){new MutationObserver((e=>{let i=!1;for(const o of e){for(const e of o.addedNodes)if(1===e.nodeType){if(e.hasAttribute&&e.hasAttribute("data-onlinefoglalas-embed")){i=!0;break}if(e.querySelector&&e.querySelector("[data-onlinefoglalas-embed]")){i=!0;break}}if(i)break}i&&(n||(n=!0,setTimeout((()=>{n=!1,o("mutation")}),50)))})).observe(document.documentElement||document.body,{childList:!0,subtree:!0})}}catch(e){console.error("OnlinefoglalasEmbed: Auto-init error",e)}}();
